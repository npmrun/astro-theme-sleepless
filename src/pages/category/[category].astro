---
import { getCollection } from 'astro:content'
import SinglePage from '@blog/layouts/SinglePage.astro'
import ArticleCard from '@blog/components/ArticleCard.astro'

export async function getStaticPaths() {
    const allPosts = await getCollection('posts')
    const uniqueCategories = [
        ...new Set(allPosts.map((post) => post.data.category).flat()),
    ]

    return uniqueCategories.map((category) => {
        const filteredPosts = allPosts.filter((post) =>
            post.data.category.includes(category)
        )
        return {
            params: { category },
            props: { posts: filteredPosts },
        }
    })
}

const { category } = Astro.params
const { posts } = Astro.props
---

<SinglePage>
    <p class="mb-8 text-2xl">{category}：</p>
    {
        !!posts.length && (
            <div class="grid grid-cols-6 auto-cols-auto gap-x-3 gap-y-4">
                {posts.map((blogPostEntry: any) => (
                    <ArticleCard
                        articleData={blogPostEntry}
                        href={`/posts/${blogPostEntry.slug}`}
                        title={blogPostEntry.data.title}
                        desc={blogPostEntry.data.describtion}
                        author={blogPostEntry.data.author}
                    />
                ))}
            </div>
        )
    }
    {
        !posts.length && (
            <div class="text-center text-gray-400 text-2xl pt-5">
                空空如也~~
            </div>
        )
    }
</SinglePage>
